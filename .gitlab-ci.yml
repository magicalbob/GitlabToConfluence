stages:
 - test
 - scan

test_job:
  stage: test
  tags:
    - linux
  script:
    - sudo apt-get update
    - sudo apt-get install -y python3-dev python3-pip
    - sh testscript.sh
  artifacts:
    paths:
      - coverage.xml
  variables:
    GIT_STRATEGY: clone

scan_job:
  stage: scan
  tags:
    - linux
  script:
    - sudo apt-get update
    - sudo apt-get install -y unzip
    - pushd ~
    - curl -o /tmp/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-${SONAR_SCANNER_VERSION}.zip
    - unzip /tmp/sonar-scanner.zip
    - popd
    - ~/sonar-scanner-4.8.0.2856/bin/sonar-scanner
  dependencies:
    - test_job
  artifacts:
    paths:
      - coverage.xml
  variables:
    GIT_STRATEGY: clone

